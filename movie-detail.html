<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Details - DJ Afro Movies Cinemax Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Additional CSS to ensure video fills the container */
        .video-container video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* Ensure the video player container is properly sized */
        .video-player-container {
            position: relative;
            width: 100%;
        }
        
        .video-player {
            position: relative;
            width: 100%;
            height: 0;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
        }
        
        .video-container, 
        .locked-message {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        /* Demo video player styling */
        .demo-video {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: #000;
            color: white;
            text-align: center;
        }
        
        .demo-player {
            width: 80%;
            max-width: 600px;
            background: var(--dark-light);
            border-radius: var(--radius);
            overflow: hidden;
            margin-bottom: 2rem;
        }
        
        .demo-controls {
            height: 300px;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(45deg, #1a1a1a, #2a2a2a);
        }
        
        .play-button {
            width: 80px;
            height: 80px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: var(--transition);
            font-size: 2rem;
            color: white;
        }
        
        .play-button:hover {
            transform: scale(1.1);
            background: var(--primary-light);
        }
        
        .demo-progress {
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            width: 100%;
        }
        
        .demo-progress-bar {
            height: 100%;
            background: var(--primary);
            width: 0%;
        }
        
        .demo-message {
            text-align: center;
            padding: 2rem;
            max-width: 600px;
        }
        
        .demo-message h3 {
            color: var(--secondary);
            margin-bottom: 1rem;
        }
        
        .demo-message p {
            color: var(--text-muted);
            margin-bottom: 0.5rem;
        }
        
        /* Format indicator */
        .format-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            z-index: 10;
        }
        
        /* Video error message */
        .video-error {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: white;
            text-align: center;
            padding: 2rem;
        }
        
        .video-error i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--primary);
        }
        
        /* Gesture areas for seeking */
        .gesture-area {
            position: absolute;
            top: 0;
            height: 100%;
            width: 30%;
            z-index: 5;
            cursor: pointer;
        }
        
        .gesture-left {
            left: 0;
        }
        
        .gesture-right {
            right: 0;
        }
        
        .gesture-center {
            left: 30%;
            width: 40%;
        }
        
        /* Gesture feedback */
        .gesture-feedback {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: bold;
            z-index: 20;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .gesture-feedback.show {
            opacity: 1;
        }
        
        .gesture-feedback.left {
            left: 20px;
        }
        
        .gesture-feedback.right {
            right: 20px;
        }
        
        /* Hide download button in controls */
        video::-webkit-media-controls {
            display: flex !important;
        }
        
        video::-webkit-media-controls-download-button {
            display: none !important;
        }
        
        video::-webkit-media-controls-enclosure {
            overflow: hidden;
        }
        
        /* Hide download option in context menu */
        video {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        /* Disable right-click context menu on video */
        .video-container {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container header-container">
            <a href="index.html" class="logo">
                <i class="fas fa-film"></i>
                DJ Afro Movies Cinemax Pro
            </a>
            
            <nav id="main-nav">
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="categories.html">Categories</a></li>
                    <li><a href="about.html">About</a></li>
                    <li><a href="contact.html">Contact</a></li>
                </ul>
            </nav>
            
            <div class="search-bar">
                <i class="fas fa-search"></i>
                <input type="text" id="search-input" placeholder="Search movies...">
            </div>
            
            <button class="mobile-menu-btn" id="mobile-menu-toggle">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <div class="container">
            <!-- VIDEO PLAYER AT THE TOP -->
            <div class="video-player-container" id="video-player-container">
                <div class="video-player locked" id="video-player">
                    <div class="locked-message" id="locked-message">
                        <i class="fas fa-lock"></i>
                        <h3>Movie Locked</h3>
                        <p>Complete the steps below to unlock this movie</p>
                    </div>
                    <div class="video-container" id="video-container" style="display: none;">
                        <!-- Video will be embedded here after successful unlock -->
                        
                        <!-- Gesture areas for seeking -->
                        <div class="gesture-area gesture-left" id="gesture-left"></div>
                        <div class="gesture-area gesture-center" id="gesture-center"></div>
                        <div class="gesture-area gesture-right" id="gesture-right"></div>
                        
                        <!-- Gesture feedback indicators -->
                        <div class="gesture-feedback left" id="seek-backward-feedback">
                            <i class="fas fa-backward"></i>
                            <span>10 seconds</span>
                        </div>
                        <div class="gesture-feedback right" id="seek-forward-feedback">
                            <i class="fas fa-forward"></i>
                            <span>10 seconds</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- COMPACT MOVIE DETAILS & UNLOCK SECTION -->
            <div class="movie-unlock-compact">
                <div class="movie-basic-info">
                    <div class="movie-poster-compact">
                        <img src="" alt="Movie Poster" id="movie-poster">
                    </div>
                    <div class="movie-header-compact">
                        <h1 id="movie-title">Movie Title</h1>
                        <div class="movie-meta-compact" id="movie-meta">
                            <!-- Movie metadata will be populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <div class="unlock-section-compact">
                    <div class="unlock-header">
                        <h2><i class="fas fa-unlock-alt"></i> Unlock to Watch</h2>
                        <div class="price-tag">Ksh <span id="movie-price">10</span></div>
                    </div>

                    <!-- Quick Steps -->
                    <div class="quick-steps">
                        <div class="step">
                            <div class="step-icon">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                            <div class="step-content">
                                <h3>Pay via M-Pesa</h3>
                                <p1>Send <strong>Ksh 10</strong> to <strong>0742774083</strong></p1>
                            </div>
                        </div>

                        <div class="step">
                            <div class="step-icon">
                                <i class="fas fa-mobile-alt"></i>
                            </div>
                            <div class="step-content">
                                <h3>Contact for Code</h3>
                                <p1>Message <strong>0742774083</strong> with:</p1>
                                <ul>
                                    <li1>• M-Pesa Transaction Code</li1>
                                    <li1>• Movie Title</li1>
                                </ul>
                            </div>
                        </div>

                        <div class="step">
                            <div class="step-icon">
                                <i class="fas fa-key"></i>
                            </div>
                            <div class="step-content">
                                <h3>Enter Code & Watch</h3>
                                <p1>You'll receive a unique code to unlock instantly</p1>
                            </div>
                        </div>
                    </div>

                    <!-- Unlock Form -->
                    <form class="unlock-form-compact" id="unlock-form">
                        <div class="form-group-compact">
                            <label for="unlock-code">
                                <i class="fas fa-lock"></i>
                                Enter Unlock Code
                            </label>
                            <input type="text" id="unlock-code" placeholder="Enter code received via SMS/WhatsApp" required>
                        </div>
                        <button type="submit" class="unlock-btn">
                            <i class="fas fa-unlock"></i>
                            Unlock & Watch Movie
                        </button>
                    </form>
                    <div id="unlock-message" style="display: none;"></div>

                    <!-- Quick Support -->
                    <div class="quick-support">
                        <p><i class="fas fa-question-circle"></i> Need help? Contact: <strong>0742774083</strong></p>
                    </div>
                </div>

                <!-- Movie Description (Collapsible) -->
                <div class="movie-description-compact">
                    <details>
                        <summary>
                            <span>Movie Description</span>
                            <i class="fas fa-chevron-down"></i>
                        </summary>
                        <p id="movie-description">Movie description will appear here.</p>
                    </details>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>AfroMovies Cinemax Pro</h3>
                    <p>Your premier destination for African movies. Quality films at affordable prices.</p>
                </div>
                
                <div class="footer-column">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="categories.html">Categories</a></li>
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="contact.html">Contact</a></li>
                    </ul>
                </div>
                
                <div class="footer-column">
                    <h3>Legal</h3>
                    <ul>
                        <li><a href="#">Terms of Service</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                        <li><a href="#">Refund Policy</a></li>
                        <li><a href="#">Content Policy</a></li>
                    </ul>
                </div>
                
                <div class="footer-column">
                    <h3>Connect With Us</h3>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
            </div>
            
            <div class="copyright">
                <p>&copy; 2023 AfroMovies Cinemax Pro. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // Enhanced Movie Data with Unique Unlock Codes and Local Video Paths
        const moviesData = {
            1: {
                id: 1,
                title: "The King's Return",
                description: "A dramatic tale of a king who returns to reclaim his throne after years in exile.",
                genre: "drama",
                year: 2023,
                language: "english",
                duration: "2h 15m",
                thumbnail: "https://images.unsplash.com/photo-1485846234645-a62644f84728?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2059&q=80",
                price: 10,
                // Support for multiple video formats
                videoFiles: [
                    { src: "videos/Downloads\Video\Tavernier scores DIRECTLY from a corner! AFC Bournemouth 2-0 Nottingham Forest - AFC Bournemouth (720p, h264).mp4", type: "video/mp4" },
                    { src: "videos/Beauty.in.Black.S01E01.720p.NF.WEBRip.x264-GalaxyTV.mkv", type: "video/x-matroska" },
                    { src: "videos/the-kings-return.avi", type: "video/x-msvideo" },
                    { src: "videos/the-kings-return.mov", type: "video/quicktime" },
                    { src: "videos/the-kings-return.webm", type: "video/webm" }
                ],
                featured: true,
                unlockCode: "KING2023XYZ789"
            },
            2: {
                id: 2,
                title: "Lagos Nights",
                description: "A thrilling action movie set in the vibrant nightlife of Lagos.",
                genre: "action",
                year: 2023,
                language: "english",
                duration: "1h 48m",
                thumbnail: "https://images.unsplash.com/photo-1595769816263-9b910be24d5f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2079&q=80",
                price: 10,
                // Support for multiple video formats
                videoFiles: [
                    { src: "videos/.mp4", type: "video/mp4" },
                    { src: "Beauty.in.Black.S01E01.720p.NF.WEBRip.x264-GalaxyTV.mkv", type: "video/x-matroska" },
                    { src: "videos/lagos-nights.avi", type: "video/x-msvideo" },
                    { src: "videos/lagos-nights.mov", type: "video/quicktime" },
                    { src: "videos/lagos-nights.webm", type: "video/webm" }
                ],
                featured: true,
                unlockCode: "LAGOS456ABC123"
            },
            3: {
                id: 3,
                title: "Love in Nairobi",
                description: "A romantic comedy about two strangers who meet in Nairobi and find love.",
                genre: "romance",
                year: 2022,
                language: "english",
                duration: "1h 55m",
                thumbnail: "https://images.unsplash.com/photo-1536440136628-849c177e76a1?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2050&q=80",
                price: 10,
                // Support for multiple video formats
                videoFiles: [
                    { src: "videos/love-in-nairobi.mp4", type: "video/mp4" },
                    { src: "videos/love-in-nairobi.mkv", type: "video/x-matroska" },
                    { src: "videos/love-in-nairobi.avi", type: "video/x-msvideo" },
                    { src: "videos/love-in-nairobi.mov", type: "video/quicktime" },
                    { src: "videos/love-in-nairobi.webm", type: "video/webm" }
                ],
                featured: false,
                unlockCode: "NAIROBI789DEF456"
            },
            4: {
                id: 4,
                title: "Safari Adventure",
                description: "An adventurous journey through the African wilderness.",
                genre: "adventure",
                year: 2023,
                language: "english",
                duration: "2h 5m",
                thumbnail: "https://images.unsplash.com/photo-1544551763-46a013bb70d5?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80",
                price: 10,
                // Support for multiple video formats
                videoFiles: [
                    { src: "videos/safari-adventure.mp4", type: "video/mp4" },
                    { src: "videos/safari-adventure.mkv", type: "video/x-matroska" },
                    { src: "videos/safari-adventure.avi", type: "video/x-msvideo" },
                    { src: "videos/safari-adventure.mov", type: "video/quicktime" },
                    { src: "videos/safari-adventure.webm", type: "video/webm" }
                ],
                featured: false,
                unlockCode: "SAFARI123GHI789"
            }
        };

        // Track used codes to prevent reuse
        let usedCodes = JSON.parse(localStorage.getItem('usedUnlockCodes')) || {};

        // Get movie ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const movieId = parseInt(urlParams.get('id'));
        const movie = moviesData[movieId];

        // Video element reference
        let videoElement = null;

        // Populate movie details
        if (movie) {
            document.getElementById('movie-poster').src = movie.thumbnail;
            document.getElementById('movie-poster').alt = movie.title;
            document.getElementById('movie-title').textContent = movie.title;
            document.getElementById('movie-description').textContent = movie.description;
            document.getElementById('movie-price').textContent = movie.price;
            
            // Populate movie metadata
            const movieMeta = document.getElementById('movie-meta');
            movieMeta.innerHTML = `
                <span><i class="fas fa-star"></i> ${movie.genre.charAt(0).toUpperCase() + movie.genre.slice(1)}</span>
                <span><i class="fas fa-calendar"></i> ${movie.year}</span>
                <span><i class="fas fa-clock"></i> ${movie.duration}</span>
                <span><i class="fas fa-language"></i> ${movie.language.charAt(0).toUpperCase() + movie.language.slice(1)}</span>
            `;

            // Check if movie is already unlocked
            const unlockKey = `movie_${movieId}_unlocked`;
            if (localStorage.getItem(unlockKey)) {
                unlockMovie(movie);
                // Scroll to video if already unlocked
                setTimeout(() => {
                    scrollToVideo();
                }, 500);
            }
        } else {
            // Movie not found
            document.querySelector('main').innerHTML = `
                <div class="container">
                    <div class="error-message">
                        <h2>Movie Not Found</h2>
                        <p>The movie you're looking for doesn't exist.</p>
                        <a href="index.html" class="cta-button">Return to Home</a>
                    </div>
                </div>
            `;
        }

        // Set up unlock form submission
        const unlockForm = document.getElementById('unlock-form');
        if (unlockForm) {
            unlockForm.addEventListener('submit', function(e) {
                e.preventDefault();
                validateUnlockCode(movie);
            });
        }

        // Validate unlock code
        function validateUnlockCode(movie) {
            const enteredCode = document.getElementById('unlock-code').value.trim();
            const submitBtn = unlockForm.querySelector('button[type="submit"]');
            const unlockMessage = document.getElementById('unlock-message');
            
            if (!enteredCode) {
                showUnlockMessage('Please enter your unlock code.', 'error');
                return;
            }
            
            // Show loading state
            const originalText = submitBtn.textContent;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Verifying Code...';
            submitBtn.disabled = true;
            
            // Simulate code verification
            setTimeout(() => {
                // Check if code matches and hasn't been used
                const codeKey = `${movie.id}_${enteredCode}`;
                
                if (enteredCode === movie.unlockCode) {
                    if (usedCodes[codeKey]) {
                        showUnlockMessage('This code has already been used. Please contact 0742774083 for assistance.', 'error');
                    } else {
                        // Mark code as used and unlock movie
                        usedCodes[codeKey] = true;
                        localStorage.setItem('usedUnlockCodes', JSON.stringify(usedCodes));
                        
                        // Mark movie as unlocked
                        const unlockKey = `movie_${movie.id}_unlocked`;
                        localStorage.setItem(unlockKey, 'true');
                        
                        unlockMovie(movie);
                        showUnlockMessage('Success! Movie unlocked. Enjoy your viewing!', 'success');
                        
                        // Clear form
                        unlockForm.reset();
                        
                        // Scroll to video player after successful unlock
                        setTimeout(() => {
                            scrollToVideo();
                        }, 800);
                    }
                } else {
                    showUnlockMessage('Invalid unlock code. Please check the code and try again. If you have not received a code, contact 0742774083.', 'error');
                }
                
                // Reset button
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }, 1500);
        }

        // Function to scroll to video player
        function scrollToVideo() {
            const videoPlayerContainer = document.getElementById('video-player-container');
            if (videoPlayerContainer) {
                videoPlayerContainer.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start'
                });
                
                // Add a subtle highlight effect
                videoPlayerContainer.style.transition = 'box-shadow 0.5s ease';
                videoPlayerContainer.style.boxShadow = '0 0 30px rgba(229, 9, 20, 0.6)';
                
                setTimeout(() => {
                    videoPlayerContainer.style.boxShadow = '';
                }, 2000);
            }
        }

        // Show unlock message
        function showUnlockMessage(message, type) {
            const unlockMessage = document.getElementById('unlock-message');
            unlockMessage.innerHTML = `
                <div class="payment-message ${type}">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;
            unlockMessage.style.display = 'block';
            
            // Auto-hide after 5 seconds (except for success messages)
            if (type !== 'success') {
                setTimeout(() => {
                    unlockMessage.style.display = 'none';
                }, 5000);
            }
        }

        // Unlock movie function
        function unlockMovie(movie) {
            const videoPlayer = document.getElementById('video-player');
            const videoContainer = document.getElementById('video-container');
            const lockedMessage = document.getElementById('locked-message');
            
            // Remove locked state
            videoPlayer.classList.remove('locked');
            
            // Hide locked message and show video container
            if (lockedMessage) {
                lockedMessage.style.display = 'none';
            }
            videoContainer.style.display = 'block';
            
            // Check for available video files
            findAvailableVideoFile(movie.videoFiles, function(availableFile) {
                if (availableFile) {
                    // Create video element with proper attributes
                    videoContainer.innerHTML = `
                        <div class="format-indicator">Format: ${availableFile.src.split('.').pop().toUpperCase()}</div>
                        <video id="movie-video" controls autoplay muted width="100%" height="100%" controlsList="nodownload" oncontextmenu="return false;">
                            <source src="${availableFile.src}" type="${availableFile.type}">
                            Your browser does not support the video tag.
                        </video>
                    `;
                    
                    // Get reference to the video element
                    videoElement = document.getElementById('movie-video');
                    
                    // Add gesture controls
                    setupGestureControls();
                    
                    // Try to play the video after a short delay
                    setTimeout(() => {
                        if (videoElement) {
                            videoElement.play().catch(error => {
                                console.log('Autoplay prevented:', error);
                                // If autoplay is blocked, show a play button
                                showManualPlayButton(movie, availableFile);
                            });
                            
                            // Handle video errors
                            videoElement.addEventListener('error', function() {
                                console.log('Video error:', videoElement.error);
                                showVideoError(movie);
                            });
                        }
                    }, 500);
                } else {
                    // No video files found
                    showVideoError(movie);
                }
            });
        }

        // Set up gesture controls
        function setupGestureControls() {
            if (!videoElement) return;
            
            const gestureLeft = document.getElementById('gesture-left');
            const gestureCenter = document.getElementById('gesture-center');
            const gestureRight = document.getElementById('gesture-right');
            const seekBackwardFeedback = document.getElementById('seek-backward-feedback');
            const seekForwardFeedback = document.getElementById('seek-forward-feedback');
            
            // Center gesture area - toggle play/pause
            gestureCenter.addEventListener('click', function(e) {
                e.stopPropagation();
                togglePlayPause();
            });
            
            // Left gesture area - seek backward
            gestureLeft.addEventListener('click', function(e) {
                e.stopPropagation();
                seekBackward();
                showGestureFeedback(seekBackwardFeedback);
            });
            
            // Right gesture area - seek forward
            gestureRight.addEventListener('click', function(e) {
                e.stopPropagation();
                seekForward();
                showGestureFeedback(seekForwardFeedback);
            });
            
            // Prevent video controls from interfering with gestures
            videoElement.addEventListener('click', function(e) {
                e.stopPropagation();
            });
        }

        // Toggle play/pause
        function togglePlayPause() {
            if (!videoElement) return;
            
            if (videoElement.paused) {
                videoElement.play();
            } else {
                videoElement.pause();
            }
        }

        // Seek backward by 10 seconds
        function seekBackward() {
            if (!videoElement) return;
            
            videoElement.currentTime = Math.max(0, videoElement.currentTime - 10);
        }

        // Seek forward by 10 seconds
        function seekForward() {
            if (!videoElement) return;
            
            videoElement.currentTime = Math.min(videoElement.duration, videoElement.currentTime + 10);
        }

        // Show gesture feedback
        function showGestureFeedback(feedbackElement) {
            feedbackElement.classList.add('show');
            setTimeout(() => {
                feedbackElement.classList.remove('show');
            }, 1000);
        }

        // Find the first available video file
        function findAvailableVideoFile(videoFiles, callback) {
            if (!videoFiles || videoFiles.length === 0) {
                callback(null);
                return;
            }
            
            // Check each video file in sequence
            function checkFile(index) {
                if (index >= videoFiles.length) {
                    callback(null);
                    return;
                }
                
                const file = videoFiles[index];
                checkFileExists(file.src, function(exists) {
                    if (exists) {
                        callback(file);
                    } else {
                        checkFile(index + 1);
                    }
                });
            }
            
            checkFile(0);
        }

        // Check if a file exists
        function checkFileExists(url, callback) {
            const xhr = new XMLHttpRequest();
            xhr.open('HEAD', url, true);
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4) {
                    callback(xhr.status === 200);
                }
            };
            xhr.onerror = function() {
                callback(false);
            };
            xhr.send();
        }

        // Show manual play button if autoplay fails
        function showManualPlayButton(movie, videoFile) {
            const videoContainer = document.getElementById('video-container');
            videoContainer.innerHTML = `
                <div class="demo-video">
                    <div class="demo-player">
                        <div class="demo-controls">
                            <div class="play-button" id="manual-play-button">
                                <i class="fas fa-play"></i>
                            </div>
                        </div>
                        <div class="demo-progress">
                            <div class="demo-progress-bar"></div>
                        </div>
                    </div>
                    <div class="demo-message">
                        <h3>Click Play to Start Watching</h3>
                        <p>${movie.title}</p>
                        <p><em>Format: ${videoFile.src.split('.').pop().toUpperCase()}</em></p>
                    </div>
                </div>
            `;
            
            // Add click event to manually play the video
            document.getElementById('manual-play-button').addEventListener('click', function() {
                videoContainer.innerHTML = `
                    <div class="format-indicator">Format: ${videoFile.src.split('.').pop().toUpperCase()}</div>
                    <video id="movie-video" controls autoplay width="100%" height="100%" controlsList="nodownload" oncontextmenu="return false;">
                        <source src="${videoFile.src}" type="${videoFile.type}">
                        Your browser does not support the video tag.
                    </video>
                `;
                videoElement = document.getElementById('movie-video');
                setupGestureControls();
                videoElement.play();
            });
        }

        // Show video error message
        function showVideoError(movie) {
            const videoContainer = document.getElementById('video-container');
            videoContainer.innerHTML = `
                <div class="video-error">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3>Video Not Available</h3>
                    <p>We couldn't find a playable video file for "${movie.title}".</p>
                    <p>Please make sure your video files are placed in the "videos" folder.</p>
                    <p>Supported formats: MP4, MKV, AVI, MOV, WebM</p>
                </div>
            `;
        }

        // Mobile menu functionality
        const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
        const mainNav = document.getElementById('main-nav');
        
        if (mobileMenuToggle && mainNav) {
            mobileMenuToggle.addEventListener('click', function() {
                mainNav.classList.toggle('active');
            });
        }
    </script>
</body>
</html>
